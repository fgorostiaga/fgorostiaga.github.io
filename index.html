<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="page.css">
  </head>
  <body onload="checkHash()">
    <img src="hlola.png" style="width: 100%; height: auto; max-width:500px">

    <h2>Specifications</h2>

    <a id="LTLCSV"></a>
    <button class="accordion" id="LTLCSVButton">LTL Example (CSV)</button>
    <div class="panel">
      <!-- Tab links -->
      <div class="tab">
        <button class="tablinks active" onclick="showTab(event, 'LTLExCSVSpec')">Specification</button>
        <button class="tablinks" onclick="showTab(event, 'LTLExCSVIO')">Input/Output</button>
      </div>

      <!-- Tab content -->
      <div id="LTLExCSVSpec" class="tabcontent" style="display:block;">
        <span style="font-family:monospace">
          <span style="color:#1944a8;font-weight: bold;">format CSV</span><br/>
          <span style="font-weight: bold;">use library </span><span style="font-weight: bold;color:#e69e22">LTL</span><br/>
          <br/>
          <span style="color:#888888;"><br/>
            #HASKELL<br/>
            data SenderState = Get | Send | WaitForAck deriving (Generic,Read,FromJSON,Eq)<br/>
            #ENDOFHASKELL<br/>
          </span><br/>
          <br/>
          <span style="color:#ff0000;">input</span> <span style="color: #136e61;font-weight: bold;">SenderState</span> <span style="color: #fa0fa0;font-weight: bold;">senderState</span><br/>
          <br/>
          <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Bool</span> <span style="color: #fa0fa0;font-weight: bold;">senderNotWaiting</span> <span style="font-weight: bold;">=</span> senderState<span style="font-weight: bold;">[now]</span> /== <span style="color:#FF4500;font-weight: bold;">&#39;</span>WaitForAck<br/>
          <br/>
          <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Bool</span> <span style="color: #fa0fa0;font-weight: bold;">prop</span> <span style="font-weight: bold;">=</span> <span style="color:#1c21b8">let</span><br/>
          &nbsp;&nbsp;senderWaitingAck = senderState<span style="font-weight: bold;">[now]</span> === <span style="color:#FF4500;font-weight: bold;">&#39;</span>WaitForAck<br/>
          &nbsp;&nbsp;startedWaiting = yesterday (historically senderNotWaiting)<br/>
          &nbsp;&nbsp;<span style="color:#1c21b8">in</span> senderWaitingAck `implies` startedWaiting<span style="font-weight: bold;">[now]</span><br/>
          <br/>
        </span>
      </div>

      <div id="LTLExCSVIO" class="tabcontent">
        IO
      </div>
    </div>

    <a id="LTLJSON"></a>
    <button class="accordion" id="LTLJSONButton">LTL Example (JSON)</button>
    <div class="panel">
      <!-- Tab links -->
      <div class="tab">
        <button class="tablinks active" onclick="showTab(event, 'LTLExJSONSpec')">Specification</button>
        <button class="tablinks" onclick="showTab(event, 'LTLExJSONIO')">Input/Output</button>
      </div>

      <!-- Tab content -->
      <div id="LTLExJSONSpec" class="tabcontent" style="display:block;">
        TODO
      </div>
      <div id="LTLExJSONIO" class="tabcontent">
        IO JSON
      </div>
    </div>

    <a id="MTLCSV"></a>
    <button class="accordion" id="MTLCSVButton">MTL Example (CSV)</button>
    <div class="panel">
      <!-- Tab links -->
      <div class="tab">
        <button class="tablinks active" onclick="showTab(event, 'MTLExCSVSpec')">Specification</button>
        <button class="tablinks" onclick="showTab(event, 'MTLExCSVIO')">Input/Output</button>
      </div>

      <!-- Tab content -->
      <div id="MTLExCSVSpec" class="tabcontent" style="display:block;">
        <span style="font-family:monospace">
          <span style="color:#1944a8;font-weight: bold;">format CSV</span><br/>
          <span style="font-weight: bold;">use library </span><span style="font-weight: bold;color:#e69e22">MTL</span><br/>
          <br/>
          <span style="color:#888888;"><br/>
            #HASKELL<br/>
            data Event<br/>
            &nbsp;&nbsp;&nbsp;&nbsp;= Alarm<br/>
            &nbsp;&nbsp;&nbsp;&nbsp;| AllClear<br/>
            &nbsp;&nbsp;&nbsp;&nbsp;| Shutdown<br/>
            &nbsp;&nbsp;deriving (Generic,Read,FromJSON,Eq)<br/>
            #ENDOFHASKELL<br/>
          </span><br/>
          <br/>
          <span style="color:#ff0000;">input</span> <span style="color: #136e61;font-weight: bold;">Event</span> <span style="color: #fa0fa0;font-weight: bold;">event</span><br/>
          <br/>
          <span style="font-weight: bold;">hidden</span> <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Bool</span> <span style="color: #fa0fa0;font-weight: bold;">allClear</span> <span style="font-weight: bold;">=</span> event<span style="font-weight: bold;">[now]</span> === <span style="color:#FF4500;font-weight: bold;">&#39;</span>AllClear<br/>
          <span style="font-weight: bold;">hidden</span> <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Bool</span> <span style="color: #fa0fa0;font-weight: bold;">shutdown</span> <span style="font-weight: bold;">=</span> event<span style="font-weight: bold;">[now]</span> === <span style="color:#FF4500;font-weight: bold;">&#39;</span>Shutdown<br/>
          <span style="font-weight: bold;">hidden</span> <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Bool</span> <span style="color: #fa0fa0;font-weight: bold;">alarm</span> <span style="font-weight: bold;">=</span> event<span style="font-weight: bold;">[now]</span> === <span style="color:#FF4500;font-weight: bold;">&#39;</span>Alarm<br/>
          <br/>
          <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Bool</span> <span style="color: #fa0fa0;font-weight: bold;">property</span> <span style="font-weight: bold;">=</span> alarm<span style="font-weight: bold;">[now]</span> `implies` (willClear <span style="font-weight: bold;">[now]</span> || willShutdown <span style="font-weight: bold;">[now]</span>)<br/>
          &nbsp;&nbsp;<span style="color:#1c21b8">where</span><br/>
          &nbsp;&nbsp;&nbsp;&nbsp;willClear = eventually (0,10) allClear<br/>
          &nbsp;&nbsp;&nbsp;&nbsp;willShutdown = eventually (10,10) shutdown<br/>
        </span>

      </div>
      <div id="MTLExCSVIO" class="tabcontent">
        IO CSV
      </div>
    </div>

    <a id="MTLJSON"></a>
    <button class="accordion" id="MTLJSONButton">MTL Example (JSON)</button>
    <div class="panel">
      <!-- Tab links -->
      <div class="tab">
        <button class="tablinks active" onclick="showTab(event, 'MTLExJSONSpec')">Specification</button>
        <button class="tablinks" onclick="showTab(event, 'MTLExJSONIO')">Input/Output</button>
      </div>

      <!-- Tab content -->
      <div id="MTLExJSONSpec" class="tabcontent" style="display:block;">
        TODO
      </div>
      <div id="MTLExJSONIO" class="tabcontent">
        IO JSON
      </div>
    </div>

    <a id="PinescriptCSV"></a>
    <button class="accordion" id="PinescriptCSVButton">Pinescript Example (CSV)</button>
    <div class="panel">
      <!-- Tab links -->
      <div class="tab">
        <button class="tablinks active" onclick="showTab(event, 'PinescriptExCSVSpec')">Specification</button>
        <button class="tablinks" onclick="showTab(event, 'PinescriptExCSVIO')">Input/Output</button>
      </div>

      <!-- Tab content -->
      <div id="PinescriptExCSVSpec" class="tabcontent" style="display:block;">
        <span style="font-family:monospace">
          <span style="color:#1944a8;font-weight: bold;">format CSV</span><br/>
          <span style="font-weight: bold;">use library </span><span style="font-weight: bold;color:#e69e22">Pinescript</span><br/>
          <br/>
          <span style="color:#888888;"><br/>
            #HASKELL<br/>
            buy_size = 10<br/>
            sell_size = 10<br/>
            #ENDOFHASKELL<br/>
          </span><br/>
          <br/>
          <span style="color:#ff0000;">input</span> <span style="color: #136e61;font-weight: bold;">Double</span> <span style="color: #fa0fa0;font-weight: bold;">close</span><br/>
          <span style="color:#ff0000;">input</span> <span style="color: #136e61;font-weight: bold;">Double</span> <span style="color: #fa0fa0;font-weight: bold;">high</span><br/>
          <br/>
          <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Bool</span> <span style="color: #fa0fa0;font-weight: bold;">buy</span> <span style="font-weight: bold;">=</span> ema18<span style="font-weight: bold;">[now]</span> &lt; high<span style="font-weight: bold;">[now]</span> &amp;&amp; macd_buy_sig<span style="font-weight: bold;">[now]</span><br/>
          <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Bool</span> <span style="color: #fa0fa0;font-weight: bold;">sell</span> <span style="font-weight: bold;">=</span> not (macd_buy_sig <span style="font-weight: bold;">[</span>-1<span style="font-weight: bold;">|</span><span style="color:#FF4500;font-weight: bold;">&#39;</span>False<span style="font-weight: bold;">]</span>) &amp;&amp; macd_sell_sig<span style="font-weight: bold;">[now]</span> &amp;&amp; positionsize <span style="font-weight: bold;">[</span>-1<span style="font-weight: bold;">|</span>0<span style="font-weight: bold;">]</span> &gt; 0<br/>
          <br/>
          <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Double</span> <span style="color: #fa0fa0;font-weight: bold;">positionsize</span> <span style="font-weight: bold;">=</span> positionsize<span style="font-weight: bold;">[</span>-1<span style="font-weight: bold;">|</span>0<span style="font-weight: bold;">]</span> + <br/>
          &nbsp;&nbsp;<span style="color:#1c21b8">if</span> buy<span style="font-weight: bold;">[now]</span> <span style="color:#1c21b8">then</span> buy_size <span style="color:#1c21b8">else</span> 0 -<br/>
          &nbsp;&nbsp;<span style="color:#1c21b8">if</span> sell<span style="font-weight: bold;">[now]</span> <span style="color:#1c21b8">then</span> sell_size <span style="color:#1c21b8">else</span> 0<br/>
          <br/>
          <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Double</span> <span style="color: #fa0fa0;font-weight: bold;">ema18</span> <span style="font-weight: bold;">=</span> ema close 18 <span style="font-weight: bold;">[now]</span><br/>
          <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Double</span> <span style="color: #fa0fa0;font-weight: bold;">signalLine</span> <span style="font-weight: bold;">=</span> macd_signal close <span style="font-weight: bold;">[now]</span><br/>
          <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Double</span> <span style="color: #fa0fa0;font-weight: bold;">macdLine</span> <span style="font-weight: bold;">=</span> macd close <span style="font-weight: bold;">[now]</span><br/>
          <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Bool</span> <span style="color: #fa0fa0;font-weight: bold;">macd_sell_sig</span> <span style="font-weight: bold;">=</span> crossover signalLine macdLine <span style="font-weight: bold;">[now]</span><br/>
          <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Bool</span> <span style="color: #fa0fa0;font-weight: bold;">macd_buy_sig</span> <span style="font-weight: bold;">=</span> crossover macdLine signalLine <span style="font-weight: bold;">[now]</span><br/>
        </span>

      </div>
      <div id="PinescriptExCSVIO" class="tabcontent">
        IO JSON
      </div>
    </div>

    <a id="PinescriptJSON"></a>
    <button class="accordion" id="PinescriptJSONButton">Pinescript Example (JSON)</button>
    <div class="panel">
      <!-- Tab links -->
      <div class="tab">
        <button class="tablinks active" onclick="showTab(event, 'PinescriptExJSONSpec')">Specification</button>
        <button class="tablinks" onclick="showTab(event, 'PinescriptExJSONIO')">Input/Output</button>
      </div>

      <!-- Tab content -->
      <div id="PinescriptExJSONSpec" class="tabcontent" style="display:block;">
        TODO
      </div>
      <div id="PinescriptExJSONIO" class="tabcontent">
        IO JSON
      </div>
    </div>

    <a id="UAV1"></a>
    <button class="accordion" id="UAV1Button">UAV specification 1</button>
    <div class="panel">
      <!-- Tab links -->
      <div class="tab">
        <button class="tablinks active" onclick="showTab(event, 'UAV1Spec')">Specification</button>
        <button class="tablinks" onclick="showTab(event, 'UAV1IO')">Input/Output</button>
      </div>

      <!-- Tab content -->
      <div id="UAV1Spec" class="tabcontent" style="display:block;">
        <span style="font-family:monospace">
          <span style="color:#1944a8;font-weight: bold;">format JSON</span><br/>
          <span style="font-weight: bold;">use theory </span><span style="font-weight: bold;color:#e69e22">Geometry2D</span><br/>
          <span style="font-weight: bold;">use library </span><span style="font-weight: bold;color:#e69e22">Utils</span><br/>
          <span style="font-weight: bold;">use haskell </span><span style="font-weight: bold;color:#e69e22">Data.Maybe</span><br/>
          <span style="font-weight: bold;">use haskell </span><span style="font-weight: bold;color:#e69e22">Data.List</span><br/>
          <br/>
          <span style="color:#888888;"><br/>
            #HASKELL<br/>
            data Attitude = Attitude {yaw :: Double, roll :: Double, pitch :: Double} deriving (Show,Generic,Read,FromJSON,ToJSON)<br/>
            data Target = Target {x :: Double, y :: Double, mutex :: Double, num_wp :: Double} deriving (Show,Generic,Read,FromJSON,ToJSON)<br/>
            data Position = Position {x :: Double, y :: Double, alt :: Double, zone :: Double} deriving (Show,Generic,Read,FromJSON,ToJSON)<br/>
            #ENDOFHASKELL<br/>
          </span><br/>
          <br/>
          <span style="color:#888888">-- Input streams</span><br/>
          <br/>
          <span style="color:#ff0000;">input</span> <span style="color: #136e61;font-weight: bold;">Attitude</span> <span style="color: #fa0fa0;font-weight: bold;">attitude</span><br/>
          <br/>
          <span style="color:#ff0000;">input</span> <span style="color: #136e61;font-weight: bold;">Vector2</span> <span style="color: #fa0fa0;font-weight: bold;">velocity</span><br/>
          <br/>
          <span style="color:#ff0000;">input</span> <span style="color: #136e61;font-weight: bold;">Position</span> <span style="color: #fa0fa0;font-weight: bold;">position</span><br/>
          <br/>
          <span style="color:#ff0000;">input</span> <span style="color: #136e61;font-weight: bold;">Double</span> <span style="color: #fa0fa0;font-weight: bold;">altitude</span><br/>
          <br/>
          <span style="color:#ff0000;">input</span> <span style="color: #136e61;font-weight: bold;">Target</span> <span style="color: #fa0fa0;font-weight: bold;">target</span><br/>
          <br/>
          <span style="color:#ff0000;">input</span> <span style="color: #136e61;font-weight: bold;">[[[Double]]]</span> <span style="color: #fa0fa0;font-weight: bold;">nofly</span><br/>
          <br/>
          <span style="color:#ff0000;">input</span> <span style="color: #136e61;font-weight: bold;">[String]</span> <span style="color: #fa0fa0;font-weight: bold;">events_within</span><br/>
          <br/>
          <span style="color:#888888">-- Output streams</span><br/>
          <br/>
          <span style="font-weight: bold;">hidden</span> <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Bool</span> <span style="color: #fa0fa0;font-weight: bold;">capturing</span> <span style="font-weight: bold;">=</span> <span style="color:#1c21b8">let</span><br/>
          &nbsp;&nbsp;has_capture = <span style="color:#FF4500;font-weight: bold;">&#39;</span>(elem &#34;capture&#34;) (events_within <span style="font-weight: bold;">[now]</span>)<br/>
          &nbsp;&nbsp;<span style="color:#1c21b8">in</span> has_capture || open_capture <span style="font-weight: bold;">[</span>-1<span style="font-weight: bold;">|</span><span style="color:#FF4500;font-weight: bold;">&#39;</span>False<span style="font-weight: bold;">]</span><br/>
          <br/>
          <span style="font-weight: bold;">hidden</span> <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Bool</span> <span style="color: #fa0fa0;font-weight: bold;">open_capture</span> <span style="font-weight: bold;">=</span> <span style="color:#1c21b8">let</span><br/>
          &nbsp;&nbsp;relevant_events = <span style="color:#FF4500;font-weight: bold;">&#39;</span>(filter isrelevant) (events_within <span style="font-weight: bold;">[now]</span>)<br/>
          &nbsp;&nbsp;<span style="color:#1c21b8">in</span> <span style="color:#FF4500;">2</span><span style="color:#FF4500;font-weight: bold;">&#39;</span>lastIsCapture (open_capture <span style="font-weight: bold;">[</span>-1<span style="font-weight: bold;">|</span><span style="color:#FF4500;font-weight: bold;">&#39;</span>False<span style="font-weight: bold;">]</span>) relevant_events<br/>
          &nbsp;&nbsp;<span style="color:#1c21b8">where</span><br/>
          &nbsp;&nbsp;lastIsCapture dflt [] = dflt<br/>
          &nbsp;&nbsp;lastIsCapture _ xs = last xs == &#34;capture&#34;<br/>
          &nbsp;&nbsp;isrelevant = flip elem [&#34;capture&#34;, &#34;yes_person&#34;, &#34;no_person&#34;]<br/>
          <br/>
          <span style="color:#888888">-- x_filt[i] = ( x[i] + tau * ( - x_filt[i-2] / 2 + 2 * x_filt[i-1] ) ) / (1.5* tau + 1)</span><br/>
          <span style="font-weight: bold;">hidden</span> <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Double</span> <span style="color: #fa0fa0;font-weight: bold;">filtered_pos_component</span> <span style="font-weight: bold;"><</span><span style="color: #136e61;font-weight: bold;">(Position -&gt; Double)</span> <span style="color: #96325d;font-weight: bold;">accessor</span><span style="font-weight: bold;">></span> <span style="font-weight: bold;"><</span><span style="color: #136e61;font-weight: bold;">String</span> <span style="color: #96325d;font-weight: bold;">nm</span><span style="font-weight: bold;">></span> <span style="font-weight: bold;">=</span> <span style="color:#1c21b8">let</span><br/>
          &nbsp;&nbsp;dt = 0.1<br/>
          &nbsp;&nbsp;tau = 6*dt<br/>
          &nbsp;&nbsp;_this = filtered_pos_component accessor nm<br/>
          &nbsp;&nbsp;nowcomp = <span style="color:#FF4500;font-weight: bold;">&#39;</span>accessor (position<span style="font-weight: bold;">[now]</span>)<br/>
          &nbsp;&nbsp;<span style="color:#1c21b8">in</span> <span style="color:#1c21b8">if</span> instantN<span style="font-weight: bold;">[now]</span> &lt; 3 <span style="color:#1c21b8">then</span> nowcomp <span style="color:#1c21b8">else</span> (nowcomp + tau * (2 * _this <span style="font-weight: bold;">[</span>-1<span style="font-weight: bold;">|</span>0<span style="font-weight: bold;">]</span> - _this <span style="font-weight: bold;">[</span>-2<span style="font-weight: bold;">|</span>0<span style="font-weight: bold;">]</span> / 2)) / (1.5 * tau + 1)<br/>
          <br/>
          <span style="font-weight: bold;">hidden</span> <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Double</span> <span style="color: #fa0fa0;font-weight: bold;">filtered_pos_x</span> <span style="font-weight: bold;">=</span> filtered_pos_component x &#34;x&#34; <span style="font-weight: bold;">[now]</span><br/>
          <br/>
          <span style="font-weight: bold;">hidden</span> <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Double</span> <span style="color: #fa0fa0;font-weight: bold;">filtered_pos_y</span> <span style="font-weight: bold;">=</span> filtered_pos_component y &#34;y&#34; <span style="font-weight: bold;">[now]</span><br/>
          <br/>
          <span style="font-weight: bold;">hidden</span> <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Double</span> <span style="color: #fa0fa0;font-weight: bold;">filtered_pos_alt</span> <span style="font-weight: bold;">=</span> filtered_pos_component alt &#34;alt&#34; <span style="font-weight: bold;">[now]</span><br/>
          <br/>
          <span style="font-weight: bold;">hidden</span> <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Point2</span> <span style="color: #fa0fa0;font-weight: bold;">filtered_pos</span> <span style="font-weight: bold;">=</span> <span style="color:#FF4500;font-weight: bold;">&#39;</span>P (filtered_pos_x <span style="font-weight: bold;">[now]</span>) (filtered_pos_y <span style="font-weight: bold;">[now]</span>)<br/>
          <br/>
          <span style="color:#888888">-- Problem with too toolLifts in the same expression</span><br/>
          <span style="font-weight: bold;">hidden</span> <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Bool</span> <span style="color: #fa0fa0;font-weight: bold;">near</span> <span style="font-weight: bold;">=</span> <span style="color:#FF4500;">2</span><span style="color:#FF4500;font-weight: bold;">&#39;</span>distance (filtered_pos <span style="font-weight: bold;">[now]</span>) target_pos &lt; 1<br/>
          &nbsp;&nbsp;<span style="color:#1c21b8">where</span> <br/>
          &nbsp;&nbsp;targetToPoint (Target x y _ _) = P x y<br/>
          &nbsp;&nbsp;target_pos = <span style="color:#FF4500;font-weight: bold;">&#39;</span>targetToPoint (target <span style="font-weight: bold;">[now]</span>)<br/>
          <br/>
          <span style="font-weight: bold;">hidden</span> <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Bool</span> <span style="color: #fa0fa0;font-weight: bold;">height_ok</span> <span style="font-weight: bold;">=</span> filtered_pos_alt <span style="font-weight: bold;">[now]</span> &gt; 0<br/>
          <br/>
          <span style="font-weight: bold;">hidden</span> <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Bool</span> <span style="color: #fa0fa0;font-weight: bold;">roll_ok</span> <span style="font-weight: bold;">=</span> <span style="color:#FF4500;font-weight: bold;">&#39;</span>(abs.roll) (attitude <span style="font-weight: bold;">[now]</span>) &lt; 0.0523<br/>
          <br/>
          <span style="font-weight: bold;">hidden</span> <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Bool</span> <span style="color: #fa0fa0;font-weight: bold;">pitch_ok</span> <span style="font-weight: bold;">=</span> <span style="color:#FF4500;font-weight: bold;">&#39;</span>(abs.pitch) (attitude<span style="font-weight: bold;">[now]</span>) &lt; 0.0523<br/>
          <br/>
          <span style="font-weight: bold;">hidden</span> <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Bool</span> <span style="color: #fa0fa0;font-weight: bold;">all_ok_capturing</span> <span style="font-weight: bold;">=</span> capturing <span style="font-weight: bold;">[now]</span> `implies` <br/>
          &nbsp;&nbsp;(height_ok <span style="font-weight: bold;">[now]</span> &amp;&amp; near <span style="font-weight: bold;">[now]</span> &amp;&amp; roll_ok <span style="font-weight: bold;">[now]</span> &amp;&amp; pitch_ok <span style="font-weight: bold;">[now]</span>)<br/>
          <br/>
          <span style="font-weight: bold;">hidden</span> <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">[Polygon]</span> <span style="color: #fa0fa0;font-weight: bold;">no_fly_polys</span> <span style="font-weight: bold;">=</span> no_fly_polys <span style="font-weight: bold;">[</span>-1<span style="font-weight: bold;">|</span><span style="color:#FF4500;font-weight: bold;">&#39;</span>(map.map$createPoint) (nofly <span style="font-weight: bold;">[now<span style="font-weight: bold;">]</span></span>)]<br/>
          &nbsp;&nbsp;<span style="color:#1c21b8">where</span><br/>
          &nbsp;&nbsp;createPoint [x,y] = P x y<br/>
          <br/>
          <span style="color:#888888">-- We assume that no-fly zones are non-overlapping</span><br/>
          <span style="font-weight: bold;">hidden</span> <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">(Maybe Polygon)</span> <span style="color: #fa0fa0;font-weight: bold;">flying_in_poly</span> <span style="font-weight: bold;">=</span> <span style="color:#1c21b8">let</span><br/>
          &nbsp;&nbsp;position_in_poly = <span style="color:#FF4500;font-weight: bold;">&#39;</span>pointInPoly (filtered_pos <span style="font-weight: bold;">[now]</span>)<br/>
          &nbsp;&nbsp;<span style="color:#1c21b8">in</span><br/>
          &nbsp;&nbsp;<span style="color:#FF4500;">2</span><span style="color:#FF4500;font-weight: bold;">&#39;</span>find position_in_poly (no_fly_polys<span style="font-weight: bold;">[now]</span>)<br/>
          <br/>
          <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Bool</span> <span style="color: #fa0fa0;font-weight: bold;">flying_in_safe_zones</span> <span style="font-weight: bold;">=</span> <span style="color:#FF4500;font-weight: bold;">&#39;</span>isNothing (flying_in_poly<span style="font-weight: bold;">[now]</span>)<br/>
          <br/>
          <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">(Maybe Double)</span> <span style="color: #fa0fa0;font-weight: bold;">depth_into_poly</span> <span style="font-weight: bold;">=</span> <span style="color:#1c21b8">let</span><br/>
          &nbsp;&nbsp;mSides = <span style="color:#FF4500;font-weight: bold;">&#39;</span>(fmap polygonSides) (flying_in_poly<span style="font-weight: bold;">[now]</span>)<br/>
          &nbsp;&nbsp;distance_from_pos = <span style="color:#FF4500;font-weight: bold;">&#39;</span>shortestDist (filtered_pos<span style="font-weight: bold;">[now]</span>)<br/>
          &nbsp;&nbsp;<span style="color:#1c21b8">in</span> <span style="color:#FF4500;">2</span><span style="color:#FF4500;font-weight: bold;">&#39;</span>fmap distance_from_pos mSides<br/>
          &nbsp;&nbsp;<span style="color:#1c21b8">where</span><br/>
          &nbsp;&nbsp;shortestDist x = minimum.map (distancePointSegment x)<br/>
        </span>
      </div>
      <div id="UAV1IO" class="tabcontent">
        IO JSON
      </div>
    </div>

    <a id="UAV2"></a>
    <button class="accordion" id="UAV2Button">UAV Specification 2</button>
    <div class="panel">
      <!-- Tab links -->
      <div class="tab">
        <button class="tablinks active" onclick="showTab(event, 'UAV2Spec')">Specification</button>
        <button class="tablinks" onclick="showTab(event, 'UAV2IO')">Input/Output</button>
      </div>

      <!-- Tab content -->
      <div id="UAV2Spec" class="tabcontent" style="display:block;">
        <span style="font-family:monospace">
          <span style="color:#1944a8;font-weight: bold;">format JSON</span><br/>
          <span style="font-weight: bold;">use theory </span><span style="font-weight: bold;color:#e69e22">Geometry2D</span><br/>
          <span style="font-weight: bold;">use theory </span><span style="font-weight: bold;color:#e69e22">SimulatedGuidance</span><br/>
          <span style="font-weight: bold;">use theory </span><span style="font-weight: bold;color:#e69e22">GuidanceTheory</span><br/>
          <span style="font-weight: bold;">use haskell </span><span style="font-weight: bold;color:#e69e22">Data.Either</span><br/>
          <br/>
          <span style="color:#ff0000;">input</span> <span style="color: #136e61;font-weight: bold;">NonLinearData</span> <span style="color: #fa0fa0;font-weight: bold;">navigation_data</span><br/>
          <br/>
          <span style="color:#ff0000;">input</span> <span style="color: #136e61;font-weight: bold;">Point2</span> <span style="color: #fa0fa0;font-weight: bold;">target</span><br/>
          <br/>
          <span style="color:#ff0000;">input</span> <span style="color: #136e61;font-weight: bold;">Vector2</span> <span style="color: #fa0fa0;font-weight: bold;">target_dir</span><br/>
          <br/>
          <span style="color:#ff0000;">input</span> <span style="color: #136e61;font-weight: bold;">Vector2</span> <span style="color: #fa0fa0;font-weight: bold;">velocity</span><br/>
          <br/>
          <span style="color:#ff0000;">input</span> <span style="color: #136e61;font-weight: bold;">Point2</span> <span style="color: #fa0fa0;font-weight: bold;">position</span><br/>
          <br/>
          <span style="font-weight: bold;">hidden</span> <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">(Matrix, Double, Double)</span> <span style="color: #fa0fa0;font-weight: bold;">kfuStream</span> <span style="font-weight: bold;">=</span> <span style="color:#1c21b8">let</span><br/>
          &nbsp;&nbsp;inroll = <span style="color:#FF4500;font-weight: bold;">&#39;</span>initial_roll (navigation_data<span style="font-weight: bold;">[now]</span>)<br/>
          &nbsp;&nbsp;prev_initial_roll = <span style="color:#FF4500;font-weight: bold;">&#39;</span>initial_roll (navigation_data <span style="font-weight: bold;">[</span>-1<span style="font-weight: bold;">|</span>navigation_data<span style="font-weight: bold;">[now<span style="font-weight: bold;">]</span></span>])<br/>
          &nbsp;&nbsp;dt = 0.05<br/>
          &nbsp;&nbsp;kfp = <span style="color:#FF4500;">3</span><span style="color:#FF4500;font-weight: bold;">&#39;</span>kalman_filter_predict (navigation_data<span style="font-weight: bold;">[now]</span>) 1 (tau <span style="font-weight: bold;">[</span>-1<span style="font-weight: bold;">|</span>0.5<span style="font-weight: bold;">]</span>)<br/>
          &nbsp;&nbsp;roll_pred = <span style="color:#FF4500;font-weight: bold;">&#39;</span>fst kfp<br/>
          &nbsp;&nbsp;tau_pred = <span style="color:#FF4500;font-weight: bold;">&#39;</span>snd kfp<br/>
          &nbsp;&nbsp;dfltM = <span style="color:#FF4500;font-weight: bold;">&#39;</span>(M [[0.01,0],[0,0.01]])<br/>
          &nbsp;&nbsp;<span style="color:#1c21b8">in</span><br/>
          &nbsp;&nbsp;<span style="color:#FF4500;">7</span><span style="color:#FF4500;font-weight: bold;">&#39;</span>kalman_filter_update (matrix_kfiltered <span style="font-weight: bold;">[</span>-1<span style="font-weight: bold;">|</span> dfltM<span style="font-weight: bold;">]</span>) prev_initial_roll (tau <span style="font-weight: bold;">[</span>-1<span style="font-weight: bold;">|</span>0.5<span style="font-weight: bold;">]</span>) inroll roll_pred tau_pred dt<br/>
          <br/>
          <br/>
          <span style="font-weight: bold;">hidden</span> <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Matrix</span> <span style="color: #fa0fa0;font-weight: bold;">matrix_kfiltered</span> <span style="font-weight: bold;">=</span> <span style="color:#FF4500;font-weight: bold;">&#39;</span>fst3 (kfuStream<span style="font-weight: bold;">[now]</span>)<br/>
          &nbsp;&nbsp;<span style="color:#1c21b8">where</span><br/>
          &nbsp;&nbsp;fst3 (x,_,_) = x<br/>
          <br/>
          <span style="font-weight: bold;">hidden</span> <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Double</span> <span style="color: #fa0fa0;font-weight: bold;">tau</span> <span style="font-weight: bold;">=</span> <span style="color:#FF4500;font-weight: bold;">&#39;</span>thd3 (kfuStream<span style="font-weight: bold;">[now]</span>)<br/>
          &nbsp;&nbsp;<span style="color:#1c21b8">where</span><br/>
          &nbsp;&nbsp;thd3 (_,_,z) = z<br/>
          <br/>
          <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Double</span> <span style="color: #fa0fa0;font-weight: bold;">intersDistance</span> <span style="font-weight: bold;">=</span> <span style="color:#1c21b8">let</span><br/>
          &nbsp;&nbsp;r0 = <span style="color:#FF4500;font-weight: bold;">&#39;</span>(,) (position<span style="font-weight: bold;">[now]</span>) (velocity<span style="font-weight: bold;">[now]</span>)<br/>
          &nbsp;&nbsp;r1 = <span style="color:#FF4500;font-weight: bold;">&#39;</span>(,) (target<span style="font-weight: bold;">[now]</span>) (target_dir<span style="font-weight: bold;">[now]</span>)<br/>
          &nbsp;&nbsp;<span style="color:#1c21b8">in</span> <span style="color:#FF4500;font-weight: bold;">&#39;</span>(fromRight (-1)) (<span style="color:#FF4500;">2</span><span style="color:#FF4500;font-weight: bold;">&#39;</span>intersectionDistance r0 r1)<br/>
          <br/>
          <span style="color:#888888">-- Set speed</span><br/>
          <br/>
          <span style="font-weight: bold;">hidden</span> <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">([Point2], Double, Bool, Double, Double)</span> <span style="color: #fa0fa0;font-weight: bold;">simulated_guidance</span> <span style="font-weight: bold;">=</span> <span style="color:#FF4500;">3</span><span style="color:#FF4500;font-weight: bold;">&#39;</span>simulate_guidance_logic (navigation_data<span style="font-weight: bold;">[now]</span>) (tau<span style="font-weight: bold;">[now]</span>) 200<br/>
          <br/>
          <span style="font-weight: bold;">hidden</span> <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">[Point2]</span> <span style="color: #fa0fa0;font-weight: bold;">simulated_guidance_wps</span> <span style="font-weight: bold;">=</span> <span style="color:#FF4500;font-weight: bold;">&#39;</span>fst5 (simulated_guidance<span style="font-weight: bold;">[now]</span>)<br/>
          &nbsp;&nbsp;<span style="color:#1c21b8">where</span><br/>
          &nbsp;&nbsp;fst5 (x,_,_,_,_) = x<br/>
          <br/>
          <span style="font-weight: bold;">hidden</span> <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">(Double, Double)</span> <span style="color: #fa0fa0;font-weight: bold;">speed_integral</span> <span style="font-weight: bold;">=</span> <span style="color:#FF4500;font-weight: bold;">&#39;</span>getVelIntegral (set_speed <span style="font-weight: bold;">[</span>-1<span style="font-weight: bold;">|</span>21<span style="font-weight: bold;">]</span>) (integral_for_speed <span style="font-weight: bold;">[</span>-1<span style="font-weight: bold;">|</span>0<span style="font-weight: bold;">]</span>) (simulated_guidance<span style="font-weight: bold;">[now]</span>)<br/>
          <br/>
          <span style="font-weight: bold;">hidden</span> <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Double</span> <span style="color: #fa0fa0;font-weight: bold;">set_speed</span> <span style="font-weight: bold;">=</span> <span style="color:#FF4500;font-weight: bold;">&#39;</span>fst (speed_integral<span style="font-weight: bold;">[now]</span>)<br/>
          <br/>
          <span style="font-weight: bold;">hidden</span> <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Double</span> <span style="color: #fa0fa0;font-weight: bold;">integral_for_speed</span> <span style="font-weight: bold;">=</span> <span style="color:#FF4500;font-weight: bold;">&#39;</span>snd (speed_integral<span style="font-weight: bold;">[now]</span>)<br/>
          <br/>
          <span style="font-weight: bold;">hidden</span> <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Estimation</span> <span style="color: #fa0fa0;font-weight: bold;">estim_data</span> <span style="font-weight: bold;">=</span> <span style="color:#FF4500;font-weight: bold;">&#39;</span>simulate_guidance (tau<span style="font-weight: bold;">[now]</span>) (navigation_data<span style="font-weight: bold;">[now]</span>)<br/>
          <br/>
          <span style="font-weight: bold;">hidden</span> <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Double</span> <span style="color: #fa0fa0;font-weight: bold;">err</span> <span style="font-weight: bold;">=</span> 21 - <span style="color:#FF4500;font-weight: bold;">&#39;</span>dist (estim_data<span style="font-weight: bold;">[now]</span>) / <span style="color:#FF4500;font-weight: bold;">&#39;</span>time (estim_data<span style="font-weight: bold;">[now]</span>)<br/>
          <br/>
          <span style="font-weight: bold;">hidden</span> <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Double</span> <span style="color: #fa0fa0;font-weight: bold;">err_int</span> <span style="font-weight: bold;">=</span> <span style="color:#1c21b8">if</span> <span style="color:#FF4500;">3</span><span style="color:#FF4500;font-weight: bold;">&#39;</span>isSaturated (pi_controller <span style="font-weight: bold;">[</span>-1<span style="font-weight: bold;">|</span>21<span style="font-weight: bold;">]</span>) 15 30 <span style="color:#1c21b8">then</span><br/>
          &nbsp;&nbsp;err_int <span style="font-weight: bold;">[</span>-1<span style="font-weight: bold;">|</span>0<span style="font-weight: bold;">]</span> <span style="color:#1c21b8">else</span> err_int <span style="font-weight: bold;">[</span>-1<span style="font-weight: bold;">|</span>0<span style="font-weight: bold;">]</span> + err<span style="font-weight: bold;">[now]</span> * 0.03<br/>
          <br/>
          <span style="font-weight: bold;">hidden</span> <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Double</span> <span style="color: #fa0fa0;font-weight: bold;">pi_controller</span> <span style="font-weight: bold;">=</span> <span style="color:#FF4500;">3</span><span style="color:#FF4500;font-weight: bold;">&#39;</span>saturate (21 + err<span style="font-weight: bold;">[now]</span> * 0.5 + err_int<span style="font-weight: bold;">[now]</span>) 15 30<br/>
        </span>
      </div>
      <div id="UAV2IO" class="tabcontent">
        IO JSON
      </div>
    </div>

    <a id="Libraries"></a>
    <button class="accordion" id="LibrariesButton">Libraries</button>
    <div class="panel">
      <!-- Tab links -->
      <div class="tab">
        <button class="tablinks active" onclick="showTab(event, 'LTLLib')">LTL</button>
        <button class="tablinks" onclick="showTab(event, 'MTLLib')">MTL</button>
        <button class="tablinks" onclick="showTab(event, 'QMTLLib')">QMTL</button>
        <button class="tablinks" onclick="showTab(event, 'PinescriptLib')">Pinescript</button>
      </div>

      <!-- Tab content -->
      <div id="LTLLib" class="tabcontent" style="display:block;">
        <span style="font-family:monospace">
          <span style="font-weight: bold;">library </span><span style="font-weight: bold;color:#e69e22">LTL</span><br/>
          <span style="font-weight: bold;">use library </span><span style="font-weight: bold;color:#e69e22">Utils</span><br/>
          <br/>
          <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Bool</span> <span style="color: #fa0fa0;font-weight: bold;">historically</span> <span style="font-weight: bold;"><</span><span style="color: #136e61;font-weight: bold;">Stream Bool</span> <span style="color: #96325d;font-weight: bold;">p</span><span style="font-weight: bold;">></span> <span style="font-weight: bold;">=</span> p<span style="font-weight: bold;">[now]</span> &amp;&amp; historically p <span style="font-weight: bold;">[</span>-1<span style="font-weight: bold;">|</span><span style="color:#FF4500;font-weight: bold;">&#39;</span>True<span style="font-weight: bold;">]</span><br/>
          <br/>
          <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Bool</span> <span style="color: #fa0fa0;font-weight: bold;">once</span> <span style="font-weight: bold;"><</span><span style="color: #136e61;font-weight: bold;">Stream Bool</span> <span style="color: #96325d;font-weight: bold;">p</span><span style="font-weight: bold;">></span> <span style="font-weight: bold;">=</span> p<span style="font-weight: bold;">[now]</span> || once p<span style="font-weight: bold;">[</span>-1<span style="font-weight: bold;">|</span><span style="color:#FF4500;font-weight: bold;">&#39;</span>False<span style="font-weight: bold;">]</span><br/>
          <br/>
          <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Bool</span> <span style="color: #fa0fa0;font-weight: bold;">since</span> <span style="font-weight: bold;"><</span><span style="color: #136e61;font-weight: bold;">Stream Bool</span> <span style="color: #96325d;font-weight: bold;">p</span><span style="font-weight: bold;">></span> <span style="font-weight: bold;"><</span><span style="color: #136e61;font-weight: bold;">Stream Bool</span> <span style="color: #96325d;font-weight: bold;">q</span><span style="font-weight: bold;">></span> <span style="font-weight: bold;">=</span> q<span style="font-weight: bold;">[now]</span> || (p<span style="font-weight: bold;">[now]</span> &amp;&amp; p `since` q <span style="font-weight: bold;">[</span>-1<span style="font-weight: bold;">|</span><span style="color:#FF4500;font-weight: bold;">&#39;</span>False<span style="font-weight: bold;">]</span>)<br/>
          <br/>
          <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Bool</span> <span style="color: #fa0fa0;font-weight: bold;">yesterday</span> <span style="font-weight: bold;"><</span><span style="color: #136e61;font-weight: bold;">Stream Bool</span> <span style="color: #96325d;font-weight: bold;">p</span><span style="font-weight: bold;">></span> <span style="font-weight: bold;">=</span> p<span style="font-weight: bold;">[</span>-1<span style="font-weight: bold;">|</span><span style="color:#FF4500;font-weight: bold;">&#39;</span>False<span style="font-weight: bold;">]</span><br/>
          <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Bool</span> <span style="color: #fa0fa0;font-weight: bold;">zesterday</span> <span style="font-weight: bold;"><</span><span style="color: #136e61;font-weight: bold;">Stream Bool</span> <span style="color: #96325d;font-weight: bold;">p</span><span style="font-weight: bold;">></span> <span style="font-weight: bold;">=</span> p<span style="font-weight: bold;">[</span>-1<span style="font-weight: bold;">|</span><span style="color:#FF4500;font-weight: bold;">&#39;</span>True<span style="font-weight: bold;">]</span><br/>
          <br/>
          <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Int</span> <span style="color: #fa0fa0;font-weight: bold;">nViolations</span> <span style="font-weight: bold;"><</span><span style="color: #136e61;font-weight: bold;">Stream Bool</span> <span style="color: #96325d;font-weight: bold;">p</span><span style="font-weight: bold;">></span> <span style="font-weight: bold;">=</span> nViolations p<span style="font-weight: bold;">[</span>-1<span style="font-weight: bold;">|</span>0<span style="font-weight: bold;">]</span> + <span style="color:#1c21b8">if</span> p<span style="font-weight: bold;">[now]</span> <span style="color:#1c21b8">then</span> 1 <span style="color:#1c21b8">else</span> 0<br/>
          <br/>
          <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Double</span> <span style="color: #fa0fa0;font-weight: bold;">percentViolations</span> <span style="font-weight: bold;"><</span><span style="color: #136e61;font-weight: bold;">Stream Bool</span> <span style="color: #96325d;font-weight: bold;">p</span><span style="font-weight: bold;">></span> <span style="font-weight: bold;">=</span> nViolations p <span style="font-weight: bold;">[now]</span> `intdivide` (instantN <span style="font-weight: bold;">[now]</span>)<br/>
        </span>
      </div>
      <div id="MTLLib" class="tabcontent">
        <span style="font-family:monospace">
          <span style="font-weight: bold;">library </span><span style="font-weight: bold;color:#e69e22">MTL</span><br/>
          <br/>
          <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Bool</span> <span style="color: #fa0fa0;font-weight: bold;">until</span> <span style="font-weight: bold;"><</span><span style="color: #136e61;font-weight: bold;">(Int, Int)</span> <span style="color: #96325d;font-weight: bold;">(a,b)</span><span style="font-weight: bold;">></span> <span style="font-weight: bold;"><</span><span style="color: #136e61;font-weight: bold;">Stream Bool</span> <span style="color: #96325d;font-weight: bold;">phi</span><span style="font-weight: bold;">></span> <span style="font-weight: bold;"><</span><span style="color: #136e61;font-weight: bold;">Stream Bool</span> <span style="color: #96325d;font-weight: bold;">psi</span><span style="font-weight: bold;">></span> <span style="font-weight: bold;">=</span> until&#39; a<br/>
          &nbsp;&nbsp;<span style="color:#1c21b8">where</span><br/>
          &nbsp;&nbsp;until&#39; a<br/>
          &nbsp;&nbsp;&nbsp;&nbsp;| a == b = psi<span style="font-weight: bold;">[</span>b<span style="font-weight: bold;">|</span> <span style="color:#FF4500;font-weight: bold;">&#39;</span>False<span style="font-weight: bold;">]</span><br/>
          &nbsp;&nbsp;&nbsp;&nbsp;| otherwise = psi<span style="font-weight: bold;">[</span>a<span style="font-weight: bold;">|</span> <span style="color:#FF4500;font-weight: bold;">&#39;</span>False<span style="font-weight: bold;">]</span> || (phi<span style="font-weight: bold;">[</span>a<span style="font-weight: bold;">|</span> <span style="color:#FF4500;font-weight: bold;">&#39;</span>True<span style="font-weight: bold;">]</span> &amp;&amp; until&#39; (a+1))<br/>
          <br/>
          <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Bool</span> <span style="color: #fa0fa0;font-weight: bold;">eventually</span> <span style="font-weight: bold;"><</span><span style="color: #136e61;font-weight: bold;">(Int, Int)</span> <span style="color: #96325d;font-weight: bold;">(a,b)</span><span style="font-weight: bold;">></span> <span style="font-weight: bold;"><</span><span style="color: #136e61;font-weight: bold;">Stream Bool</span> <span style="color: #96325d;font-weight: bold;">phi</span><span style="font-weight: bold;">></span> <span style="font-weight: bold;">=</span> foldl (||) <span style="color:#FF4500;font-weight: bold;">&#39;</span>False [phi<span style="font-weight: bold;">[</span>i<span style="font-weight: bold;">|</span><span style="color:#FF4500;font-weight: bold;">&#39;</span>False<span style="font-weight: bold;">]</span> | i &lt;- [a..b]]<br/>
          <br/>
          <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Bool</span> <span style="color: #fa0fa0;font-weight: bold;">historically</span> <span style="font-weight: bold;"><</span><span style="color: #136e61;font-weight: bold;">Int</span> <span style="color: #96325d;font-weight: bold;">k</span><span style="font-weight: bold;">></span> <span style="font-weight: bold;"><</span><span style="color: #136e61;font-weight: bold;">Stream Bool</span> <span style="color: #96325d;font-weight: bold;">p</span><span style="font-weight: bold;">></span> <span style="font-weight: bold;">=</span> consecutiveTrue p <span style="font-weight: bold;">[now]</span> &gt; <span style="color:#FF4500;font-weight: bold;">&#39;</span>k<br/>
          <br/>
          <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">Int</span> <span style="color: #fa0fa0;font-weight: bold;">consecutiveTrue</span> <span style="font-weight: bold;"><</span><span style="color: #136e61;font-weight: bold;">Stream Bool</span> <span style="color: #96325d;font-weight: bold;">p</span><span style="font-weight: bold;">></span> <span style="font-weight: bold;">=</span> <span style="color:#1c21b8">if</span> not (p<span style="font-weight: bold;">[now]</span>) <span style="color:#1c21b8">then</span> 0 <span style="color:#1c21b8">else</span> consecutiveTrue p<span style="font-weight: bold;">[</span>-1<span style="font-weight: bold;">|</span>0<span style="font-weight: bold;">]</span> + 1<br/>
        </span>
      </div>
      <div id="QMTLLib" class="tabcontent">
        <span style="font-family:monospace">
          <span style="font-weight: bold;">library </span><span style="font-weight: bold;color:#e69e22">QMTL</span><br/>
          <br/>
          <span style="font-weight: bold;">use library </span><span style="font-weight: bold;color:#e69e22">Utils</span><br/>
          <br/>
          <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">(Eq a, Fractional a, Streamable a) =&gt; a</span> <span style="color: #fa0fa0;font-weight: bold;">medianLast</span> <span style="font-weight: bold;"><</span><span style="color: #136e61;font-weight: bold;">Int</span> <span style="color: #96325d;font-weight: bold;">k</span><span style="font-weight: bold;">></span> <span style="font-weight: bold;"><</span><span style="color: #136e61;font-weight: bold;">Stream a</span> <span style="color: #96325d;font-weight: bold;">str</span><span style="font-weight: bold;">></span> <span style="font-weight: bold;">=</span> <span style="color:#1c21b8">let</span><br/>
          &nbsp;&nbsp;denom = <span style="color:#FF4500;font-weight: bold;">&#39;</span>(fromIntegral.min k) (instantN<span style="font-weight: bold;">[now]</span>)<br/>
          &nbsp;&nbsp;numerator = foldl (+) 0 [str <span style="font-weight: bold;">[</span>i<span style="font-weight: bold;">|</span>0<span style="font-weight: bold;">]</span> | i &lt;- [(1-k)..0]]<br/>
          &nbsp;&nbsp;<span style="color:#1c21b8">in</span> numerator / denom<br/>
        </span>
      </div>
      <div id="PinescriptLib" class="tabcontent">
        <span style="font-family:monospace">
          <span style="font-weight: bold;">library </span><span style="font-weight: bold;color:#e69e22">Pinescript</span><br/>
          <span style="font-weight: bold;">use library </span><span style="font-weight: bold;color:#e69e22">Utils</span><br/>
          <br/>
          <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">(Num a, Eq a, Streamable a) =&gt; a</span> <span style="color: #fa0fa0;font-weight: bold;">sumLast</span> <span style="font-weight: bold;"><</span><span style="color: #136e61;font-weight: bold;">Stream a</span> <span style="color: #96325d;font-weight: bold;">str</span><span style="font-weight: bold;">></span> <span style="font-weight: bold;"><</span><span style="color: #136e61;font-weight: bold;">Int</span> <span style="color: #96325d;font-weight: bold;">n</span><span style="font-weight: bold;">></span> <span style="font-weight: bold;">=</span> sumLast str n <span style="font-weight: bold;">[</span>-1<span style="font-weight: bold;">|</span>0<span style="font-weight: bold;">]</span> + str<span style="font-weight: bold;">[now]</span> - str<span style="font-weight: bold;">[</span>-n<span style="font-weight: bold;">|</span>0<span style="font-weight: bold;">]</span><br/>
          <br/>
          <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">(Fractional a, Eq a, Streamable a) =&gt; a</span> <span style="color: #fa0fa0;font-weight: bold;">sma</span> <span style="font-weight: bold;"><</span><span style="color: #136e61;font-weight: bold;">Stream a</span> <span style="color: #96325d;font-weight: bold;">str</span><span style="font-weight: bold;">></span> <span style="font-weight: bold;"><</span><span style="color: #136e61;font-weight: bold;">Int</span> <span style="color: #96325d;font-weight: bold;">n</span><span style="font-weight: bold;">></span> <span style="font-weight: bold;">=</span> <span style="color:#1c21b8">let</span><br/>
          &nbsp;&nbsp;denominator = <span style="color:#FF4500;font-weight: bold;">&#39;</span>(fromIntegral.min n) (instantN<span style="font-weight: bold;">[now]</span>)<br/>
          &nbsp;&nbsp;<span style="color:#1c21b8">in</span> sumLast str n <span style="font-weight: bold;">[now]</span> / denominator<br/>
          <br/>
          <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">(Fractional a, Eq a, Streamable a) =&gt; a</span> <span style="color: #fa0fa0;font-weight: bold;">wma</span> <span style="font-weight: bold;"><</span><span style="color: #136e61;font-weight: bold;">Stream a</span> <span style="color: #96325d;font-weight: bold;">str</span><span style="font-weight: bold;">></span> <span style="font-weight: bold;"><</span><span style="color: #136e61;font-weight: bold;">Int</span> <span style="color: #96325d;font-weight: bold;">n</span><span style="font-weight: bold;">></span> <span style="font-weight: bold;">=</span> <span style="color:#1c21b8">let</span><br/>
          &nbsp;&nbsp;slots = <span style="color:#FF4500;font-weight: bold;">&#39;</span>(min n) (instantN<span style="font-weight: bold;">[now]</span>)<br/>
          &nbsp;&nbsp;sumFirstN = <span style="color:#FF4500;font-weight: bold;">&#39;</span>fromIntegral (<span style="color:#FF4500;">2</span><span style="color:#FF4500;font-weight: bold;">&#39;</span>div (slots * (slots + 1)) 2)<br/>
          &nbsp;&nbsp;<span style="color:#1c21b8">in</span> foldl (+) 0 [str <span style="font-weight: bold;">[</span>-i<span style="font-weight: bold;">|</span>0<span style="font-weight: bold;">]</span> * <span style="color:#FF4500;font-weight: bold;">&#39;</span>(fromIntegral (n-i)) | i&lt;-[0..n-1]] / sumFirstN<br/>
          <br/>
          <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">(Fractional a, Eq a, Streamable a) =&gt; a</span> <span style="color: #fa0fa0;font-weight: bold;">ema</span> <span style="font-weight: bold;"><</span><span style="color: #136e61;font-weight: bold;">Stream a</span> <span style="color: #96325d;font-weight: bold;">str</span><span style="font-weight: bold;">></span> <span style="font-weight: bold;"><</span><span style="color: #136e61;font-weight: bold;">Int</span> <span style="color: #96325d;font-weight: bold;">n</span><span style="font-weight: bold;">></span> <span style="font-weight: bold;">=</span> <span style="color:#1c21b8">let</span><br/>
          &nbsp;&nbsp;emaprev = ema str n <span style="font-weight: bold;">[</span>-1<span style="font-weight: bold;">|</span>0<span style="font-weight: bold;">]</span><br/>
          &nbsp;&nbsp;multiplier = <span style="color:#FF4500;font-weight: bold;">&#39;</span>((2 P./).fromIntegral.min n) (instantN<span style="font-weight: bold;">[now]</span>)<br/>
          &nbsp;&nbsp;<span style="color:#1c21b8">in</span> (str<span style="font-weight: bold;">[now]</span> - emaprev) * multiplier + emaprev<br/>
          <br/>
          <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">(Fractional a, Eq a, Streamable a) =&gt; a</span> <span style="color: #fa0fa0;font-weight: bold;">macd</span> <span style="font-weight: bold;"><</span><span style="color: #136e61;font-weight: bold;">Stream a</span> <span style="color: #96325d;font-weight: bold;">str</span><span style="font-weight: bold;">></span> <span style="font-weight: bold;">=</span> ema str 12<span style="font-weight: bold;">[now]</span> - ema str 26 <span style="font-weight: bold;">[now]</span><br/>
          <br/>
          <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">(Fractional a, Eq a, Streamable a) =&gt; a</span> <span style="color: #fa0fa0;font-weight: bold;">macd_signal</span> <span style="font-weight: bold;"><</span><span style="color: #136e61;font-weight: bold;">Stream a</span> <span style="color: #96325d;font-weight: bold;">str</span><span style="font-weight: bold;">></span> <span style="font-weight: bold;">=</span> ema (macd str) 9 <span style="font-weight: bold;">[now]</span><br/>
          <br/>
          <span style="font-weight: bold;">output</span> <span style="color: #136e61;font-weight: bold;">(Num a, Ord a, Eq a, Streamable a) =&gt; Bool</span> <span style="color: #fa0fa0;font-weight: bold;">crossover</span> <span style="font-weight: bold;"><</span><span style="color: #136e61;font-weight: bold;">Stream a</span> <span style="color: #96325d;font-weight: bold;">str0</span><span style="font-weight: bold;">></span> <span style="font-weight: bold;"><</span><span style="color: #136e61;font-weight: bold;">Stream a</span> <span style="color: #96325d;font-weight: bold;">str1</span><span style="font-weight: bold;">></span> <span style="font-weight: bold;">=</span> str1<span style="font-weight: bold;">[now]</span> &lt;= str0<span style="font-weight: bold;">[now]</span> &amp;&amp; str0<span style="font-weight: bold;">[</span>-1<span style="font-weight: bold;">|</span>0<span style="font-weight: bold;">]</span> &lt;= str1 <span style="font-weight: bold;">[</span>-1<span style="font-weight: bold;">|</span>0<span style="font-weight: bold;">]</span><br/>
        </span>
      </div>
    </div>

    <script src="page.js"></script>
  </body>
</html>
